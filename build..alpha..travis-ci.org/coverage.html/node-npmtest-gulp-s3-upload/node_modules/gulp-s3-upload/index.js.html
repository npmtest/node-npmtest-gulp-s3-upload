<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for node-npmtest-gulp-s3-upload/node_modules/gulp-s3-upload/index.js</title>
    <meta charset="utf-8">
    <style>
        body, html {
            margin:0; padding: 0;
        }
        body {
            font-family: Arial, Helvetica;
            font-size: 10pt;
        }
        div.header, div.footer {
            background: #eee;
            padding: 1em;
        }
        div.header {
            height: 160px;
            padding: 0 1em 0 1em;
            z-index: 100;
            position: fixed;
            top: 0;
            border-bottom: 1px solid #666;
            width: 100%;
        }
        div.footer {
            border-top: 1px solid #666;
        }
        div.body {
            margin-top: 170px;
        }
        div.meta {
            font-size: 90%;
            text-align: center;
        }
        h1, h2, h3 {
            font-weight: normal;
        }
        h1 {
            font-size: 12pt;
        }
        h2 {
            font-size: 10pt;
        }
        pre {
            font-family: Menlo, Monaco, Consolas, Courier New, monospace;
            margin: 0;
            padding: 0;
            font-size: 14px;
            tab-size: 2;
        }

        div.path { font-size: 110%; }
        div.path a:link, div.path a:visited { color: #000; }
        table.coverage { border-collapse: collapse; margin:0; padding: 0 }

        table.coverage td {
            margin: 0;
            padding: 0;
            color: #111;
            vertical-align: top;
        }
        table.coverage td.line-count {
            width: 50px;
            text-align: right;
            padding-right: 5px;
        }
        table.coverage td.line-coverage {
            color: #777 !important;
            text-align: right;
            border-left: 1px solid #666;
            border-right: 1px solid #666;
        }

        table.coverage td.text {
        }

        table.coverage td span.cline-any {
            display: inline-block;
            padding: 0 5px;
            width: 40px;
        }
        table.coverage td span.cline-neutral {
            background: #eee;
        }
        table.coverage td span.cline-yes {
            background: #b5d592;
            color: #999;
        }
        table.coverage td span.cline-no {
            background: #fc8c84;
        }

        .cstat-yes { color: #111; }
        .cstat-no { background: #fc8c84; color: #111; }
        .fstat-no { background: #ffc520; color: #111 !important; }
        .cbranch-no { background:  yellow !important; color: #111; }

        .cstat-skip { background: #ddd; color: #111; }
        .fstat-skip { background: #ddd; color: #111 !important; }
        .cbranch-skip { background: #ddd !important; color: #111; }

        .missing-if-branch {
            display: inline-block;
            margin-right: 10px;
            position: relative;
            padding: 0 4px;
            background: black;
            color: yellow;
        }

        .skip-if-branch {
            display: none;
            margin-right: 10px;
            position: relative;
            padding: 0 4px;
            background: #ccc;
            color: white;
        }

        .missing-if-branch .typ, .skip-if-branch .typ {
            color: inherit !important;
        }

        .entity, .metric { font-weight: bold; }
        .metric { display: inline-block; border: 1px solid #333; padding: 0.3em; background: white; }
        .metric small { font-size: 80%; font-weight: normal; color: #666; }

        div.coverage-summary table { border-collapse: collapse; margin: 3em; font-size: 110%; }
        div.coverage-summary td, div.coverage-summary table  th { margin: 0; padding: 0.25em 1em; border-top: 1px solid #666; border-bottom: 1px solid #666; }
        div.coverage-summary th { text-align: left; border: 1px solid #666; background: #eee; font-weight: normal; }
        div.coverage-summary th.file { border-right: none !important; }
        div.coverage-summary th.pic { border-left: none !important; text-align: right; }
        div.coverage-summary th.pct { border-right: none !important; }
        div.coverage-summary th.abs { border-left: none !important; text-align: right; }
        div.coverage-summary td.pct { text-align: right; border-left: 1px solid #666; }
        div.coverage-summary td.abs { text-align: right; font-size: 90%; color: #444; border-right: 1px solid #666; }
        div.coverage-summary td.file { text-align: right; border-left: 1px solid #666; white-space: nowrap;  }
        div.coverage-summary td.pic { min-width: 120px !important;  }
        div.coverage-summary a:link { color: #000; }
        div.coverage-summary a:visited { color: #333; }
        div.coverage-summary tfoot td { border-top: 1px solid #666; }

        div.coverage-summary .yui3-datatable-sort-indicator, div.coverage-summary .dummy-sort-indicator {
            height: 10px;
            width: 7px;
            display: inline-block;
            margin-left: 0.5em;
        }
        div.coverage-summary .yui3-datatable-sort-indicator {
            background: no-repeat scroll 0 0 transparent;
        }
        div.coverage-summary .yui3-datatable-sorted .yui3-datatable-sort-indicator {
            background-position: 0 -20px;
        }
        div.coverage-summary .yui3-datatable-sorted-desc .yui3-datatable-sort-indicator {
            background-position: 0 -10px;
        }

        .high { background: #b5d592 !important; }
        .medium { background: #ffe87c !important; }
        .low { background: #fc8c84 !important; }

        span.cover-fill, span.cover-empty {
            display:inline-block;
            border:1px solid #444;
            background: white;
            height: 12px;
        }
        span.cover-fill {
            background: #ccc;
            border-right: 1px solid #444;
        }
        span.cover-empty {
            background: white;
            border-left: none;
        }
        span.cover-full {
            border-right: none !important;
        }
        pre.prettyprint {
            border: none !important;
            padding: 0 !important;
            margin: 0 !important;
        }
        .com { color: #999 !important; }
        .ignore-none { color: #999; font-weight: normal; }

    </style>
</head>
<body>
<div class="header low">
    <h1 style="font-weight: bold;">
        <a href="https://github.com/npmtest/node-npmtest-gulp-s3-upload">npmtest-gulp-s3-upload (v0.0.1)</a>
    </h1>
    <h1>Code coverage report for <span class="entity">node-npmtest-gulp-s3-upload/node_modules/gulp-s3-upload/index.js</span></h1>
    <h2>
        
        Statements: <span class="metric">4.04% <small>(4 / 99)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Branches: <span class="metric">0% <small>(0 / 98)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Functions: <span class="metric">0% <small>(0 / 7)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Lines: <span class="metric">4.04% <small>(4 / 99)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        Ignored: <span class="metric"><span class="ignore-none">none</span></span> &nbsp;&nbsp;&nbsp;&nbsp;
    </h2>
    <div class="path"><a href="../../../index.html">All files</a> &#187; <a href="index.html">node-npmtest-gulp-s3-upload/node_modules/gulp-s3-upload/</a> &#187; index.js</div>
</div>
<div class="body">
<pre><table class="coverage">
<tr><td class="line-count">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320</td><td class="line-coverage"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">/****
    gulp-s3-upload
    gulp plugin for uploading assets into AWS's S3 service.
****/
&nbsp;
var es          = require('event-stream')
,   gutil       = require('gulp-util')
,   AWS         = require('aws-sdk')
,   path        = require('path')
,   mime        = require('mime')
,   hasha       = require('hasha')
,   _           = require('underscore')
,   helper      = require('./src/helper.js')
,   PluginError = gutil.PluginError
,   gulpPrefixer
;
&nbsp;
const PLUGIN_NAME = 'gulp-s3-upload';
&nbsp;
gulpPrefixer = <span class="fstat-no" title="function not covered" >function (AWS) {</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    return <span class="fstat-no" title="function not covered" >function (options, s3conf) {</span></span>
&nbsp;
<span class="cstat-no" title="statement not covered" >        var stream</span>
        ,   _s3         = new AWS.S3(s3conf || {})
        ,   the_bucket  = options.Bucket || options.bucket
        ;
&nbsp;
<span class="cstat-no" title="statement not covered" >        if(!the_bucket) {</span>
<span class="cstat-no" title="statement not covered" >            throw new PluginError(PLUGIN_NAME, "Missing S3 bucket name!");</span>
        }
&nbsp;
        //  Async File Uploading
&nbsp;
<span class="cstat-no" title="statement not covered" >        stream = es.map(<span class="fstat-no" title="function not covered" >function (file, callback) {</span></span>
&nbsp;
<span class="cstat-no" title="statement not covered" >            var keyTransform, keyname, keyparts, filename,</span>
                mimetype, mime_lookup_name, hash, nohash
<span class="cstat-no" title="statement not covered" >                metadata = null, content_encoding = null</span>
            ;
&nbsp;
<span class="cstat-no" title="statement not covered" >            if(file.isNull()) {</span>
                //  Do nothing if no contents
<span class="cstat-no" title="statement not covered" >                return callback(null);</span>
            }
&nbsp;
            //  =====================================================
            //  ============= METHOD TRANSFORMS &amp; LOOKUPS ===========
            //  =====================================================
&nbsp;
            //  === Key Transform ===================================
            //  Allow for either keyTransform or nameTransform.
            //  We're using Key to be consistent with AWS-S3.
&nbsp;
<span class="cstat-no" title="statement not covered" >            keyTransform = options.keyTransform || options.nameTransform; </span>  // old option name
&nbsp;
<span class="cstat-no" title="statement not covered" >            if(keyTransform) {</span>
&nbsp;
                //  Allow the transform function to take the
                //  complete path in case the user wants to change
                //  the path of the file, too.
&nbsp;
<span class="cstat-no" title="statement not covered" >                keyname = keyTransform(file.relative);</span>
&nbsp;
            } else {
                // ...Otherwise keep it exactly parallel.
&nbsp;
<span class="cstat-no" title="statement not covered" >                keyparts = helper.parsePath(file.relative);</span>
<span class="cstat-no" title="statement not covered" >                keyname  = helper.buildName(keyparts.dirname, keyparts.basename + keyparts.extname);</span>
            }
&nbsp;
&nbsp;
<span class="cstat-no" title="statement not covered" >            keyname = keyname.replace(/\\/g, "/"); </span>// JIC Windows (uses backslashes)
&nbsp;
&nbsp;
            // === Mime Lookup/Transform ============================
&nbsp;
<span class="cstat-no" title="statement not covered" >            mime_lookup_name = keyname;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >            if (options.mimeTypeLookup) {</span>
<span class="cstat-no" title="statement not covered" >                mime_lookup_name = options.mimeTypeLookup(keyname);</span>
            }
&nbsp;
<span class="cstat-no" title="statement not covered" >            mimetype = mime.lookup(mime_lookup_name);</span>
&nbsp;
            // === Charset ==========================================
            // JIC text files get garbled. Appends to mimetype.
            // `charset` field gets filtered out later.
&nbsp;
<span class="cstat-no" title="statement not covered" >            if (options.charset &amp;&amp; mimetype == 'text/html') {</span>
<span class="cstat-no" title="statement not covered" >                mimetype += ';charset=' + options.charset;</span>
            }
&nbsp;
            //  === metadataMap =====================================
            //  Map files (using the keyname) to a metadata object.
            //  ONLY if `options.Metadata` is undefined.
            //  ** WILL DEPRICATE IN 2.0.0 **
&nbsp;
<span class="cstat-no" title="statement not covered" >            if (_.isFunction(options.metadataMap)) {</span>
<span class="cstat-no" title="statement not covered" >                metadata = options.metadataMap;</span>
            } else <span class="cstat-no" title="statement not covered" >if(_.isObject(options.metadataMap)) {</span>
<span class="cstat-no" title="statement not covered" >                options.Metadata = options.metadataMap;</span>
            }
&nbsp;
            //  *Note: `options.Metadata` is not filtered out later.
&nbsp;
            //  === manualContentEncoding ===========================
            //  Similar to metadataMap to put global / individual
            //  headers on each file object (only if
            //  options.ContentEncoding) is undefined. (1.2)
            //  ** WILL DEPRICATE IN 2.0.0 **
&nbsp;
<span class="cstat-no" title="statement not covered" >            if(_.isFunction(options.manualContentEncoding)) {</span>
<span class="cstat-no" title="statement not covered" >                content_encoding = options.manualContentEncoding;</span>
            } else <span class="cstat-no" title="statement not covered" >if(_.isString(options.manualContentEncoding)) {</span>
<span class="cstat-no" title="statement not covered" >                options.ContentEncoding = options.manualContentEncoding;</span>
            }
&nbsp;
            //  Check the file that's up in the bucket already
&nbsp;
<span class="cstat-no" title="statement not covered" >            _s3.headObject({</span>
                'Bucket': the_bucket,
                'Key': keyname
            }, <span class="fstat-no" title="function not covered" >function (head_err, head_data) {</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >                var obj_opts;</span>
&nbsp;
                //  If object doesn't exist then S3 returns 404 or 403 depending on whether you have s3:ListBucket permission.
                //  See http://docs.aws.amazon.com/AmazonS3/latest/API/RESTObjectHEAD.html#rest-object-head-permissions
<span class="cstat-no" title="statement not covered" >                if(head_err &amp;&amp; !(head_err.statusCode === 404 || head_err.statusCode === 403)) {</span>
<span class="cstat-no" title="statement not covered" >                    return callback(new gutil.PluginError(PLUGIN_NAME, "S3 headObject Error: " + head_err.stack));</span>
                }
&nbsp;
                //  === ETag Hash Comparison =============================
                //  Do a local hash comparison to reduce
                //  the overhead from calling upload anyway.
                //  Add the option for a different algorithm
                //  JIC for some reason the algorithm is not MD5.
                //  Available algorithms are those available w/ default
                //  node `crypto` plugin. (run `crypto.getCiphers()`)
&nbsp;
<span class="cstat-no" title="statement not covered" >                if(!options.etag_hash) {</span>
                    //  If not defined, default to md5. 
<span class="cstat-no" title="statement not covered" >                    options.etag_hash = 'md5';</span>
                }
&nbsp;
                //  Hashing requires us to have the entire contents of
                //  the file. This is not possible for streams.
<span class="cstat-no" title="statement not covered" >                nohash = file.isStream() || options.etag_hash == 'none';</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >                hash = nohash ? 'nohash' : hasha(file._contents, {'algorithm': options.etag_hash});</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >                if(!nohash &amp;&amp; head_data &amp;&amp; head_data.ETag === '"' + hash + '"') {</span>
&nbsp;
                    //  AWS ETag doesn't match local ETag
<span class="cstat-no" title="statement not covered" >                    gutil.log(gutil.colors.gray("No Change ..... "), keyname);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >                    if (options.onNoChange &amp;&amp; typeof options.onNoChange === 'function') {</span>
<span class="cstat-no" title="statement not covered" >                        options.onNoChange.call(this, keyname);</span>
                    }
&nbsp;
<span class="cstat-no" title="statement not covered" >                    callback(null);</span>
&nbsp;
                } else {
&nbsp;
                    /*** FILE "LOOP" ***/
&nbsp;
<span class="cstat-no" title="statement not covered" >                    obj_opts = _.extend({}, helper.filterOptions(options)); </span>// always make sure clean hash
&nbsp;
<span class="cstat-no" title="statement not covered" >                    obj_opts.Bucket     = the_bucket;</span>
<span class="cstat-no" title="statement not covered" >                    obj_opts.Key        = keyname;</span>
<span class="cstat-no" title="statement not covered" >                    obj_opts.Body       = file.contents;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >                    if(mimetype.length) {</span>
                        //  A check in case of map ContentType
<span class="cstat-no" title="statement not covered" >                        obj_opts.ContentType = mimetype;</span>
                    }
&nbsp;
<span class="cstat-no" title="statement not covered" >                    if(_.isFunction(metadata)) {</span>
                        // existing obj_opts.Metadata gets overwrriten
<span class="cstat-no" title="statement not covered" >                        obj_opts.Metadata = metadata(keyname);</span>
                    }
&nbsp;
<span class="cstat-no" title="statement not covered" >                    if(_.isFunction(content_encoding)) {</span>
                        // existing obj_opts.ContentEncoding gets overwrriten
<span class="cstat-no" title="statement not covered" >                        obj_opts.ContentEncoding = content_encoding(keyname);</span>
                    }
&nbsp;
                    //  === maps.ParamNames =================================
                    //  This is a new mapper object that, if given in the
                    //  options as `maps.ParamName`, and is a function, will
                    //  run the given function and map that param data, given
                    //  that the return value of the `maps.ParamName` function
                    //  returns the appropriate type for that give putObject Param
                    //  { Bucket: ... maps: { 'CacheControl': function()..., 'Expires': function()... }, etc. }
                    //  See: http://docs.aws.amazon.com/AWSJavaScriptSDK/latest/AWS/S3.html#putObject-property
                    //  This will end up overwriting old Metadata and ContentEncoding
                    //  if they were included in maps hash.
&nbsp;
<span class="cstat-no" title="statement not covered" >                    if(!_.isUndefined(options.maps)) {</span>
<span class="cstat-no" title="statement not covered" >                        _.each(options.maps, <span class="fstat-no" title="function not covered" >function(mapRoutine, param_name) {</span></span>
<span class="cstat-no" title="statement not covered" >                            if(_.isFunction(mapRoutine)) {</span>
<span class="cstat-no" title="statement not covered" >                                obj_opts[param_name] = mapRoutine(keyname);</span>
                            }
                        });
                    }
&nbsp;
<span class="cstat-no" title="statement not covered" >                    if (options.uploadNewFilesOnly &amp;&amp; !head_data || !options.uploadNewFilesOnly) {</span>
&nbsp;
                        //  When using streams, the ContentLength must be
                        //  known to S3. This is only possible if the incoming
                        //  vinyl file somehow carries the byte length.
&nbsp;
<span class="cstat-no" title="statement not covered" >                        if (file.isStream()) {</span>
<span class="cstat-no" title="statement not covered" >                            if (file.stat) {</span>
<span class="cstat-no" title="statement not covered" >                                obj_opts.ContentLength = file.stat.size;</span>
                            } else {
<span class="cstat-no" title="statement not covered" >                                return callback(new gutil.PluginError(PLUGIN_NAME, "S3 Upload of streamObject must have a ContentLength"));</span>
                            }
                        }
&nbsp;
<span class="cstat-no" title="statement not covered" >                        gutil.log(gutil.colors.cyan("Uploading ..... "), keyname);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >                        _s3.putObject(obj_opts, <span class="fstat-no" title="function not covered" >function (err, data) {</span></span>
&nbsp;
<span class="cstat-no" title="statement not covered" >                            if (err) {</span>
<span class="cstat-no" title="statement not covered" >                                return callback(new gutil.PluginError(PLUGIN_NAME, "S3 putObject Error: " + err.stack));</span>
                            }
&nbsp;
<span class="cstat-no" title="statement not covered" >                            if (head_data) {</span>
<span class="cstat-no" title="statement not covered" >                                if (head_data.ETag !== data.ETag) {</span>
<span class="cstat-no" title="statement not covered" >                                    gutil.log(gutil.colors.yellow("Updated ....... "), keyname);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >                                    if (options.onChange &amp;&amp; typeof options.onChange === 'function') {</span>
<span class="cstat-no" title="statement not covered" >                                        options.onChange.call(this, keyname);</span>
                                    }
&nbsp;
                                } else {
<span class="cstat-no" title="statement not covered" >                                    gutil.log(gutil.colors.gray("No Change ..... "), keyname);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >                                    if (options.onNoChange &amp;&amp; typeof options.onNoChange === 'function') {</span>
<span class="cstat-no" title="statement not covered" >                                        options.onNoChange.call(this, keyname);</span>
                                    }
                                    
                                }
                            } else {
                                // Doesn't exist in bucket; the object is new to the bucket
<span class="cstat-no" title="statement not covered" >                                gutil.log(gutil.colors.green("Uploaded! ..... "), keyname);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >                                if (options.onNew &amp;&amp; typeof options.onNew === 'function') {</span>
<span class="cstat-no" title="statement not covered" >                                    options.onNew.call(this, keyname);</span>
                                }
                            }
&nbsp;
<span class="cstat-no" title="statement not covered" >                            callback(null);</span>
                        });
&nbsp;
                        /*** END FILE LOOP ***/
                    }
                }
            });
        });
&nbsp;
<span class="cstat-no" title="statement not covered" >        return stream;</span>
    };
};
&nbsp;
// ===== EXPORTING MAIN PLUGIN FUNCTION =====
// `config` now takes the paramters from the AWS-SDK constructor:
// http://docs.aws.amazon.com/AWSJavaScriptSDK/latest/AWS/Config.html#constructor-property
&nbsp;
module.exports = <span class="fstat-no" title="function not covered" >function(config, s3_config) {</span>
<span class="cstat-no" title="statement not covered" >    var aws_config = {};</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    if(_.isUndefined(config)) {</span>
<span class="cstat-no" title="statement not covered" >        config = {};</span>
    }
&nbsp;
    //  Maintain backwards compatibility with legacy key and secret options
<span class="cstat-no" title="statement not covered" >    if(config.key) {</span>
<span class="cstat-no" title="statement not covered" >        aws_config.accessKeyId = config.key;</span>
    }
&nbsp;
<span class="cstat-no" title="statement not covered" >    if(config.secret) {</span>
<span class="cstat-no" title="statement not covered" >        aws_config.secretAccessKey = config.secret;</span>
    }
&nbsp;
    //  If using IAM
&nbsp;
<span class="cstat-no" title="statement not covered" >    if(_.has(config, 'useIAM') &amp;&amp; config.useIAM) {</span>
<span class="cstat-no" title="statement not covered" >        config = {};</span>
    }
&nbsp;
    //  Intentionally not mandating the accessKeyId and secretAccessKey as they
    //  will be loaded automatically by the SDK from either environment variables
    //  or the credentials file.
    //  http://docs.aws.amazon.com/AWSJavaScriptSDK/guide/node-configuring.html
&nbsp;
    // Configure the proxy if an environment variable is present.
&nbsp;
<span class="cstat-no" title="statement not covered" >    if(process.env.HTTPS_PROXY) {</span>
<span class="cstat-no" title="statement not covered" >        gutil.log("Setting https proxy to %s", process.env.HTTPS_PROXY);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >        if(!aws_config.httpOptions) {</span>
<span class="cstat-no" title="statement not covered" >            aws_config.httpOptions = {};</span>
        }
&nbsp;
<span class="cstat-no" title="statement not covered" >        var HttpsProxyAgent = require('https-proxy-agent');</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >        aws_config.httpOptions.agent = new HttpsProxyAgent(process.env.HTTPS_PROXY);</span>
    }
&nbsp;
    //  Update the global AWS config if we have any overrides
&nbsp;
<span class="cstat-no" title="statement not covered" >    AWS.config.update(_.extend({}, config, aws_config));</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    return gulpPrefixer(AWS, s3_config);</span>
};
&nbsp;
&nbsp;</pre></td></tr>
</table></pre>
</div>
<div class="footer">
    <div class="meta">Generated by <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a> at Wed Apr 19 2017 22:50:52 GMT+0000 (UTC)</div>
</div>
</body>
</html>
